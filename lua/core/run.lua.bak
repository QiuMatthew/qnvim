local buffer = 16

vim.api.nvim_create_autocmd("BufWritePost", {
	group = vim.api.nvim_create_augroup("AutoSave", { clear = true }),
	pattern = "*.go",
	callback = function()
		vim.api.nvim_buf_set_lines(buffer, 0, -1, false, { "=======Execute Start=======" })
		-- vim.fn.jobstart({ "echo", "Hello", "World" }, {
		-- vim.fn.jobstart({ "python", "pytest.py" }, {
		vim.fn.jobstart({ "go", "run", "gotest.go" }, {
			-- Note: Get the result lines as soon as it appears. If this is set as true, we will not get any output until the command finishes.
			stdout_buffered = true,
			on_stdout = function(_, data)
				if data then
					vim.api.nvim_buf_set_lines(buffer, -1, -1, false, data)
				end
			end,
			on_stderr = function(_, data)
				if data then
					vim.api.nvim_buf_set_lines(buffer, -1, -1, false, data)
				end
			end,
			on_exit = function()
				vim.api.nvim_buf_set_lines(buffer, -1, -1, false, { "========Execute End========" })
			end,
		})
	end,
})
